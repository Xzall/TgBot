Telegram Bot Project

Это проект Telegram-бота на основе Spring Boot, предназначенный для обработки форм пользователей и генерации отчетов. Бот позволяет пользователям заполнять форму с именем, email и оценкой, а также генерировать отчеты с данными завершенных форм.
Возможности

Обработка форм: Пользователи могут начать форму (/form), ввести имя, email и оценку (от 1 до 10).
Генерация отчетов: Генерирует .docx отчет с данными завершенных форм (/report).
Ограничение по времени: Незавершенные формы удаляются из базы данных через 1 минуту.
Постоянная клавиатура: Предоставляет постоянную клавиатуру с кнопками "Заполнить форму" и "Отчет".
Обработка ошибок: Уведомляет пользователей, если время заполнения истекло или ввод некорректен.

Требования

Java 17 или выше
Docker и Docker Compose
PostgreSQL (настроен через Docker)
Maven (для сборки проекта)

Установка

Клонирование репозитория
git clone <url-репозитория>
cd <директория-репозитория>


Настройка окружения

Создай или отредактируй файл .env с переменными окружения:
BOT_TOKEN=ваш_токен_бота
BOT_USERNAME=имя_вашего_бота

Убедись, что токен и имя бота соответствуют твоему Telegram-боту.

Файл application.yml в src/main/resources уже содержит базовую конфигурацию:
server:
port: 8080
spring:
datasource:
url: ${DB_URL:jdbc:postgresql://localhost:5432/dbdb}
username: ${DB_USER:postgres}
password: ${DB_PASSWORD:1234}
jpa:
hibernate:
ddl-auto: update
show-sql: true
properties:
hibernate:
dialect: org.hibernate.dialect.PostgreSQLDialect
sql:
init:
mode: always
data-locations: classpath:init.sql
bot:
token: ${BOT_TOKEN:7641856824:AAFw9Ay8iT30_nLm7gVoH7zFmZk7bcWSJBo}
username: ${BOT_USERNAME:@jBlazzzyBot}


Замени значения переменных окружения (BOT_TOKEN, BOT_USERNAME, DB_URL, DB_USER, DB_PASSWORD) при необходимости.




Сборка и запуск с Docker

Убедись, что Docker запущен.

Собери и запусти приложение:
docker-compose up --build


Файл Dockerfile используется для сборки образа с Maven и запуска приложения на Amazon Corretto 17.

Файл docker-compose.yml настраивает сервисы:

bot: Запускает бота с зависимостью от базы данных.
db: Запускает PostgreSQL с инициализацией из init.sql.





Использование

Запуск бота: Используй /start, чтобы начать взаимодействие с ботом.
Заполнение формы: Используй /form или кнопку "Заполнить форму", затем следуй подсказкам для ввода имени, email и оценки.
Генерация отчета: Используй /report или кнопку "Отчет" для создания отчета с завершенными формами.
Ограничение по времени: Если форма не завершена в течение 1 минуты, она истекает, и при дальнейших попытках ввода появится сообщение "Время заполнения вышло, попробуйте еще раз".

Структура проекта

BotLauncher.java: Инициализирует и регистрирует Telegram-бота.
User.java: Сущность для хранения данных пользователей (chatId, username, state).
Response.java: Сущность для хранения ответов форм (userId, name, email, rating, createdAt, isCompleted).
TelegramBot.java: Основной класс бота, наследующий TelegramLongPollingBot.
ReportService.java: Генерирует .docx отчет с таблицей завершенных ответов.
ResponseRepository.java: Репозиторий JPA для сущности Response.
BotService.java: Основной сервис, обрабатывающий команды, ввод форм и очистку устаревших форм.
TgBotApplication.java: Точка входа Spring Boot приложения с поддержкой планирования и асинхронности.
AsyncConfig.java: Настраивает пул потоков для асинхронной генерации отчетов.
UserRepository.java: Репозиторий JPA для сущности User.
init.sql: Инициализирует таблицы users и responses в PostgreSQL.
Dockerfile: Описывает этапы сборки и запуска приложения.
docker-compose.yml: Настраивает контейнеры для бота и базы данных.
application.yml: Основной файл конфигурации Spring Boot.
application-test.yml: Конфигурация для тестового окружения с H2.
.env: Файл с переменными окружения для локального запуска.

Тестирование

Тестовое окружение настроено в application-test.yml с использованием H2 базы данных.
Тесты пока не реализованы. В будущем можно добавить тестовые сценарии для обработки форм, генерации отчетов и проверки таймаутов.

Логирование

Логи управляются через SLF4J и доступны в логах Docker:docker-compose logs bot


Включен show-sql: true для отладки SQL-запросов.

Участие в разработке

Приветствуются вопросы или пулл-реквесты. Убедись, что код соответствует структуре проекта и включает соответствующее логирование.

Лицензия

Лицензия MIT (или укажи предпочитаемую лицензию).

Контакты

Для поддержки обращайся к авторам проекта или создавай проблему в репозитории.

